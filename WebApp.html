<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaga Web App</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas {
            border: 2px solid white;
        }
        #log {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: monospace;
            max-height: 100px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
        }
        #win-message, #lose-message {
            position: absolute;
            color: yellow;
            font-size: 48px;
            font-family: Arial, sans-serif;
            display: none;
            text-align: center;
            width: 100%;
            top: 40%;
            transform: translateY(-50%);
        }
        #restart-button {
            position: absolute;
            color: white;
            background: blue;
            border: 2px solid white;
            padding: 10px 20px;
            font-size: 24px;
            font-family: Arial, sans-serif;
            cursor: pointer;
            display: none;
            text-align: center;
            width: 200px;
            left: 50%;
            top: 60%;
            transform: translateX(-50%);
        }
        #restart-button:hover {
            background: darkblue;
        }
        #scratch-link {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            text-decoration: none;
        }
        #scratch-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="log"></div>
    <div id="win-message">You Win!</div>
    <div id="lose-message">You Lost</div>
    <button id="restart-button">Restart Game</button>
    <a id="scratch-link" href="ScratchPage.html">Go to Scratch Page</a>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Starfield background
        let stars = [];
        const starCount = 100;

        for (let i = 0; i < starCount; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2 + 1,
                speed: Math.random() * 1.5 + 0.5
            });
        }

        function drawStars() {
            ctx.fillStyle = 'white';
            stars.forEach(star => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function updateStars() {
            stars.forEach(star => {
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });
        }

        const logDiv = document.getElementById('log');
        const winMessage = document.getElementById('win-message');
        const loseMessage = document.getElementById('lose-message');
        const restartButton = document.getElementById('restart-button');

        // Player
        let player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 30,
            height: 30,
            speed: 5,
            alive: true
        };

        // Bullets
        let bullets = [];
        const bulletSpeed = 7;
        const bulletWidth = 5;
        const bulletHeight = 10;

        // Alien Bullets
        let alienBullets = [];
        const alienBulletSpeed = 5;
        const alienBulletWidth = 5;
        const alienBulletHeight = 10;
        const alienShootChance = 0.001;

        // Aliens
        let aliens = [];
        const alienWidth = 30;
        const alienHeight = 30;
        const alienRows = 2;
        const alienCols = 5;
        const alienSpeed = 2;
        let alienDirection = 1;
        const totalAliens = alienRows * alienCols;
        let aliensDestroyed = 0;

        let mouseX = 0;
        let mouseY = 0;

        let gameOver = false;

        function initAliens() {
            aliens = [];
            for (let row = 0; row < alienRows; row++) {
                for (let col = 0; col < alienCols; col++) {
                    aliens.push({
                        x: col * (alienWidth + 10) + 150,
                        y: row * (alienHeight + 10) + 50,
                        width: alienWidth,
                        height: alienHeight,
                        alive: true
                    });
                }
            }
        }

        function resetGame() {
            player = {
                x: canvas.width / 2,
                y: canvas.height - 50,
                width: 30,
                height: 30,
                speed: 5,
                alive: true
            };
            bullets = [];
            alienBullets = [];
            aliensDestroyed = 0;
            gameOver = false;
            winMessage.style.display = 'none';
            loseMessage.style.display = 'none';
            restartButton.style.display = 'none';
            initAliens();
        }

        function drawPlayer() {
            if (player.alive) {
                ctx.fillStyle = 'lime';
                ctx.fillRect(player.x - player.width / 2, player.y - player.height / 2, player.width, player.height);
            }
        }

        function drawBullets() {
            ctx.fillStyle = 'red';
            bullets.forEach(bullet => {
                ctx.fillRect(bullet.x - bullet.width / 2, bullet.y, bullet.width, bullet.height);
            });
        }

        function drawAlienBullets() {
            ctx.fillStyle = 'orange';
            alienBullets.forEach(bullet => {
                ctx.fillRect(bullet.x - bullet.width / 2, bullet.y, bullet.width, bullet.height);
            });
        }

        function updateBullets() {
            bullets = bullets.filter(bullet => bullet.y > 0);
            bullets.forEach(bullet => bullet.y -= bulletSpeed);
        }

        function updateAlienBullets() {
            alienBullets = alienBullets.filter(bullet => bullet.y < canvas.height);
            alienBullets.forEach(bullet => bullet.y += alienBulletSpeed);
        }

        function aliensShoot() {
            aliens.forEach(alien => {
                if (alien.alive && Math.random() < alienShootChance) {
                    alienBullets.push({
                        x: alien.x + alien.width / 2,
                        y: alien.y + alien.height,
                        width: alienBulletWidth,
                        height: alienBulletHeight
                    });
                }
            });
        }

        function updateAliens() {
            let edgeHit = false;
            aliens.forEach(alien => {
                if (alien.alive) {
                    alien.x += alienSpeed * alienDirection;
                    if (alien.x + alien.width > canvas.width || alien.x < 0) {
                        edgeHit = true;
                    }
                }
            });
            if (edgeHit) {
                alienDirection *= -1;
                aliens.forEach(alien => alien.y += 20);
            }
        }

        function checkCollisions() {
            bullets.forEach((bullet, i) => {
                aliens.forEach((alien, j) => {
                    if (alien.alive &&
                        bullet.x < alien.x + alien.width &&
                        bullet.x + bullet.width > alien.x &&
                        bullet.y < alien.y + alien.height &&
                        bullet.y + bullet.height > alien.y) {
                        alien.alive = false;
                        bullets.splice(i, 1);
                        aliensDestroyed++;
                    }
                });
            });

            alienBullets.forEach(bullet => {
                if (player.alive &&
                    bullet.x < player.x + player.width / 2 &&
                    bullet.x > player.x - player.width / 2 &&
                    bullet.y < player.y + player.height / 2 &&
                    bullet.y + bullet.height > player.y - player.height / 2) {
                    player.alive = false;
                }
            });

            if (aliensDestroyed === totalAliens) {
                winMessage.style.display = 'block';
                restartButton.style.display = 'block';
                gameOver = true;
            }

            if (!player.alive) {
                loseMessage.style.display = 'block';
                restartButton.style.display = 'block';
                gameOver = true;
            }
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowLeft') player.x -= player.speed;
            if (e.key === 'ArrowRight') player.x += player.speed;
            if (e.key === ' ' && player.alive) {
                bullets.push({
                    x: player.x,
                    y: player.y - player.height / 2,
                    width: bulletWidth,
                    height: bulletHeight
                });
            }
        });

        restartButton.addEventListener('click', resetGame);

        function gameLoop() {
            if (!gameOver) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                updateStars();
                drawStars();

                drawPlayer();
                drawBullets();
                drawAlienBullets();
                drawAliens();
                updateBullets();
                updateAlienBullets();
                aliensShoot();
                updateAliens();
                checkCollisions();
            }
            requestAnimationFrame(gameLoop);
        }

        resetGame();
        gameLoop();
    </script>
</body>
</html>
